- name: Install uwsgi
  ansible.builtin.apt:
    name: uwsgi

- name: Install uwsgi-plugin-python3
  ansible.builtin.apt:
    name: uwsgi-plugin-python3

- name: Create uwsgi config file
  ansible.builtin.copy:
    dest: /etc/uwsgi/apps-enabled/agama.ini
    content: "[uwsgi]\n
      chdir = /opt/agama\n
      module = agama:app\n
      env = AGAMA_DATABASE_URI=/opt/agama/db.sqlite3\n
      plugins = python3\n
      socket = localhost:5000\n
      uid = agama"
  notify: Restart uwsgi